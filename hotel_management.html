<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management - Oscar's System</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
        }
        
        .header {
            text-align: center;
            color: white;
            padding: 20px 10px;
        }
        
        .header h1 {
            font-size: 24px;
            margin: 0 0 10px 0;
        }
        
        .header p {
            font-size: 14px;
            margin: 0;
            opacity: 0.9;
        }
        
        .back-button {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .back-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .main-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .main-content h2 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
        }
        
        .search-section {
            margin-bottom: 30px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
            min-height: 44px;
        }
        
        .search-input:focus {
            border-color: #667eea;
        }
        
        .hotel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .hotel-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .hotel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .hotel-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .hotel-details {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .hotel-details div {
            margin-bottom: 5px;
        }
        
        .hotel-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .edit-btn {
            background: #ffc107;
            color: #333;
        }
        
        .update-btn {
            background: #28a745;
            color: white;
        }
        
        .view-btn {
            background: #17a2b8;
            color: white;
        }
        
        .sync-btn {
            background: #6f42c1;
            color: white;
        }
        
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .priority-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .priority-p1 {
            background: #dc3545;
            color: white;
        }
        
        .priority-p2 {
            background: #ffc107;
            color: #333;
        }
        
        .priority-p3 {
            background: #28a745;
            color: white;
        }
        
        .update-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            margin: 50px auto;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #333;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            float: right;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #667eea;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .save-btn {
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .cancel-btn {
            background: #6c757d;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .sync-indicator {
            background: #e8f5e8;
            border: 1px solid #28a745;
            color: #155724;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 10px;
            display: none;
        }
        
        .last-updated {
            font-size: 11px;
            color: #999;
            margin-top: 10px;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 24px;
            margin: 0 0 5px 0;
        }
        
        .stat-card p {
            font-size: 12px;
            margin: 0;
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .hotel-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 20px;
                padding: 20px;
            }
            
            .hotel-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-button" onclick="window.location.href='index.html'">‚Üê Back to Dashboard</button>
        
        <div class="header">
            <h1>üè® Hotel Management</h1>
            <p>Manage hotel database, update contact information, and sync with visit data</p>
        </div>
        
        <div class="main-content">
            <div class="stats-section">
                <div class="stat-card">
                    <h3 id="totalHotels">0</h3>
                    <p>Total Hotels</p>
                </div>
                <div class="stat-card">
                    <h3 id="recentlyUpdated">0</h3>
                    <p>Recently Updated</p>
                </div>
                <div class="stat-card">
                    <h3 id="syncedFromVisits">0</h3>
                    <p>Synced from Visits</p>
                </div>
            </div>
            
        <div class="search-section">
            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                <button class="add-hotel-btn" onclick="openAddHotelModal()" style="background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap;">+ Add New Hotel</button>
                <input type="text" class="search-input" id="searchInput" placeholder="üîç Search hotels by name, location, or type..." oninput="filterHotels()" style="flex: 1;">
            </div>
        </div>
            
            <div class="hotel-grid" id="hotelGrid">
                <!-- Hotels will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Update Modal -->
    <div class="update-modal" id="updateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Hotel Information</h3>
                <button class="close-btn" onclick="closeUpdateModal()">&times;</button>
            </div>
            
            <form id="updateForm" onsubmit="saveHotelUpdate(event)">
                <div class="form-group">
                    <label for="updateName">Hotel Name</label>
                    <input type="text" id="updateName" required>
                </div>
                
                <div class="form-group">
                    <label for="updateAddress">Address</label>
                    <input type="text" id="updateAddress">
                </div>
                
                <div class="form-group">
                    <label for="updateArea">Area</label>
                    <input type="text" id="updateArea">
                </div>
                
                <div class="form-group">
                    <label for="updateType">Type</label>
                    <select id="updateType">
                        <option value="5-star luxury">5-star luxury</option>
                        <option value="4-star luxury">4-star luxury</option>
                        <option value="Boutique luxury">Boutique luxury</option>
                        <option value="Business hotel">Business hotel</option>
                        <option value="Historic luxury">Historic luxury</option>
                        <option value="Luxury boutique">Luxury boutique</option>
                        <option value="Luxury townhouse">Luxury townhouse</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="updatePriority">Priority</label>
                    <select id="updatePriority">
                        <option value="P1">P1 - High Priority</option>
                        <option value="P2">P2 - Medium Priority</option>
                        <option value="P3">P3 - Low Priority</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="updatePhone">Phone</label>
                    <input type="tel" id="updatePhone" placeholder="+44 20 1234 5678">
                </div>
                
                <div class="form-group">
                    <label for="updateEmail">Email</label>
                    <input type="email" id="updateEmail" placeholder="info@hotel.com">
                </div>
                
                <div class="form-group">
                    <label for="updateWhatsapp">WhatsApp Number</label>
                    <input type="tel" id="updateWhatsapp" placeholder="+44 7XXX XXXXXX">
                </div>
                
                <div class="form-group">
                    <label for="updateRevenue">Revenue (¬£)</label>
                    <input type="number" id="updateRevenue" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label for="updateBookings">Bookings</label>
                    <input type="number" id="updateBookings" placeholder="0">
                </div>
                
                <div class="sync-indicator" id="syncIndicator">
                    üîÑ This hotel data was automatically updated from recent visit forms
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeUpdateModal()">Cancel</button>
                    <button type="submit" class="save-btn">üíæ Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Hotel Modal -->
    <div class="update-modal" id="addHotelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Hotel</h3>
                <button class="close-btn" onclick="closeAddHotelModal()">&times;</button>
            </div>
            
            <form onsubmit="saveNewHotel(event)">
                <div class="form-group">
                    <label for="newHotelName">Hotel Name *</label>
                    <input type="text" id="newHotelName" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="newHotelLocation">Location *</label>
                    <input type="text" id="newHotelLocation" name="location" required>
                </div>
                
                <div class="form-group">
                    <label for="newHotelType">Hotel Type</label>
                    <select id="newHotelType" name="type">
                        <option value="5-star luxury">5-star luxury</option>
                        <option value="4-star">4-star</option>
                        <option value="Boutique">Boutique</option>
                        <option value="Business hotel">Business hotel</option>
                        <option value="Resort">Resort</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="newHotelPriority">Priority Level</label>
                    <select id="newHotelPriority" name="priority">
                        <option value="P1">P1 - High Priority</option>
                        <option value="P2">P2 - Medium Priority</option>
                        <option value="P3">P3 - Low Priority</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="newHotelEmail">Contact Email</label>
                    <input type="email" id="newHotelEmail" name="email">
                </div>
                
                <div class="form-group">
                    <label for="newHotelPhone">Phone Number</label>
                    <input type="tel" id="newHotelPhone" name="phone">
                </div>
                
                <div class="form-group">
                    <label for="newHotelWhatsapp">WhatsApp Number</label>
                    <input type="tel" id="newHotelWhatsapp" name="whatsapp">
                </div>
                
                <div class="form-group">
                    <label for="newHotelNotes">Notes</label>
                    <textarea id="newHotelNotes" name="notes" rows="3"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeAddHotelModal()">Cancel</button>
                    <button type="submit" class="save-btn">Add Hotel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        let hotels = [];
        let currentHotel = null;
        
        // Initialize
        document.addEventListener(\'DOMContentLoaded\', function() {           loadHotels();
            syncFromVisitForms();
            updateStats();
            displayHotels();
        });
        
        // Load hotels from database
        async function loadHotels() {
            try {
                // Load from database file
                const response = await fetch('hotels_database.json');
                if (response.ok) {
                    hotels = await response.json();
                    
                    // Merge with any local updates
                    const localUpdates = JSON.parse(localStorage.getItem('hotel_updates') || '{}');
                    hotels = hotels.map(hotel => {
                        const hotelId = hotel.name.toLowerCase().replace(/[^a-z0-9]/g, '_');
                        if (localUpdates[hotelId]) {
                            return { ...hotel, ...localUpdates[hotelId], lastUpdated: localUpdates[hotelId].lastUpdated };
                        }
                        return hotel;
                    });
                    
                    console.log(`Loaded ${hotels.length} hotels`);
                }
            } catch (error) {
                console.error('Error loading hotels:', error);
            }
        }
        
        // Sync hotel data from visit forms
        function syncFromVisitForms() {
            const visits = JSON.parse(localStorage.getItem('oscar_visits') || '[]');
            const completedVisits = JSON.parse(localStorage.getItem('visitHistory') || '[]');
            let syncCount = 0;
            
            // Combine all visits
            const allVisits = [...visits, ...completedVisits];
            
            allVisits.forEach(visit => {
                if (visit.contactEmail || visit.contactPhone || visit.whatsappNumber) {
                    const hotel = hotels.find(h => 
                        h.name.toLowerCase().includes(visit.hotel?.toLowerCase() || '') ||
                        visit.hotel?.toLowerCase().includes(h.name.toLowerCase())
                    );
                    
                    if (hotel) {
                        let updated = false;
                        
                        // Update email if not present or different
                        if (visit.contactEmail && (!hotel.email || hotel.email !== visit.contactEmail)) {
                            hotel.email = visit.contactEmail;
                            updated = true;
                        }
                        
                        // Update phone if not present or different
                        if (visit.contactPhone && (!hotel.phone || hotel.phone !== visit.contactPhone)) {
                            hotel.phone = visit.contactPhone;
                            updated = true;
                        }
                        
                        // Add WhatsApp number if provided
                        if (visit.whatsappNumber && (!hotel.whatsapp || hotel.whatsapp !== visit.whatsappNumber)) {
                            hotel.whatsapp = visit.whatsappNumber;
                            updated = true;
                        }
                        
                        if (updated) {
                            hotel.lastUpdated = new Date().toISOString();
                            hotel.syncedFromVisits = true;
                            syncCount++;
                        }
                    }
                }
            });
            
            if (syncCount > 0) {
                saveHotelUpdates();
                console.log(`Synced ${syncCount} hotels from visit forms`);
            }
        }
        
        // Save hotel updates to localStorage
        function saveHotelUpdates() {
            const updates = {};
            hotels.forEach(hotel => {
                if (hotel.lastUpdated) {
                    const hotelId = hotel.name.toLowerCase().replace(/[^a-z0-9]/g, '_');
                    updates[hotelId] = {
                        phone: hotel.phone,
                        email: hotel.email,
                        whatsapp: hotel.whatsapp,
                        revenue: hotel.revenue,
                        bookings: hotel.bookings,
                        lastUpdated: hotel.lastUpdated,
                        syncedFromVisits: hotel.syncedFromVisits
                    };
                }
            });
            localStorage.setItem('hotel_updates', JSON.stringify(updates));
        }
        
        // Update statistics
        function updateStats() {
            const totalHotels = hotels.length;
            const recentlyUpdated = hotels.filter(h => {
                if (!h.lastUpdated) return false;
                const updateDate = new Date(h.lastUpdated);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return updateDate > weekAgo;
            }).length;
            const syncedFromVisits = hotels.filter(h => h.syncedFromVisits).length;
            
            document.getElementById('totalHotels').textContent = totalHotels;
            document.getElementById('recentlyUpdated').textContent = recentlyUpdated;
            document.getElementById('syncedFromVisits').textContent = syncedFromVisits;
        }
        
        // Display hotels
        function displayHotels(filteredHotels = null) {
            const hotelGrid = document.getElementById('hotelGrid');
            const hotelsToShow = filteredHotels || hotels;
            
            hotelGrid.innerHTML = '';
            
            hotelsToShow.forEach(hotel => {
                const hotelCard = document.createElement('div');
                hotelCard.className = 'hotel-card';
                
                const lastUpdated = hotel.lastUpdated ? 
                    `<div class="last-updated">Last updated: ${new Date(hotel.lastUpdated).toLocaleDateString()}</div>` : '';
                
                const syncIndicator = hotel.syncedFromVisits ? 
                    `<div class="sync-indicator" style="display: block;">üîÑ Auto-synced from visits</div>` : '';
                
                hotelCard.innerHTML = `
                    <div class="hotel-name">${hotel.name}</div>
                    <div class="hotel-details">
                        <div><strong>Area:</strong> ${hotel.area || 'N/A'}</div>
                        <div><strong>Type:</strong> ${hotel.type || 'N/A'}</div>
                        <div><strong>Priority:</strong> <span class="priority-badge priority-${hotel.priority?.toLowerCase() || 'p3'}">${hotel.priority || 'P3'}</span></div>
                        <div><strong>Phone:</strong> ${hotel.phone || 'Not provided'}</div>
                        <div><strong>Email:</strong> ${hotel.email || 'Not provided'}</div>
                        ${hotel.whatsapp ? `<div><strong>WhatsApp:</strong> ${hotel.whatsapp}</div>` : ''}
                        <div><strong>Revenue:</strong> ¬£${(hotel.revenue || 0).toLocaleString()}</div>
                        <div><strong>Bookings:</strong> ${(hotel.bookings || 0).toLocaleString()}</div>
                    </div>
                    ${syncIndicator}
                    ${lastUpdated}
                    <div class="hotel-actions">
                        <button class="action-btn view-btn" onclick="viewHotel(\'${hotel.name}\')">üëÅÔ∏è View</button>
                            <button class="action-btn communication-btn" onclick="viewCommunication(\'${hotel.name}\')">üí¨ Communication</button>                       <button class="action-btn edit-btn" onclick="editHotel('${hotel.name}')">‚úèÔ∏è Edit</button>
                        <button class="action-btn update-btn" onclick="updateHotel('${hotel.name}')">üîÑ Update</button>
                        <button class="action-btn sync-btn" onclick="syncHotelFromVisits('${hotel.name}')">üîó Sync</button>
                    </div>
                `;
                
                hotelGrid.appendChild(hotelCard);
            });
        }
        
        // Search hotels
        function filterHotels() {
            const query = document.getElementById("searchInput").value.toLowerCase();
            if (query.length < 3 && query.length !== 0) {
                displayHotels([]); // Show no hotels if query is less than 3 characters and not empty
                return;
            }
            
            if (!query) {
                displayHotels();
                return;
            }
            
            const filtered = hotels.filter(hotel => 
                hotel.name.toLowerCase().includes(query) ||
                hotel.area?.toLowerCase().includes(query) ||
                hotel.type?.toLowerCase().includes(query) ||
                hotel.email?.toLowerCase().includes(query)
            );
            
            displayHotels(filtered);
        }
        
        // View hotel details
        function viewHotel(hotelName) {
            const hotel = hotels.find(h => h.name === hotelName);
            if (hotel) {
                const details = `
Hotel: ${hotel.name}
Address: ${hotel.address || 'N/A'}
Area: ${hotel.area || 'N/A'}
Type: ${hotel.type || 'N/A'}
Priority: ${hotel.priority || 'P3'}
Phone: ${hotel.phone || 'Not provided'}
Email: ${hotel.email || 'Not provided'}
WhatsApp: ${hotel.whatsapp || 'Not provided'}
Revenue: ¬£${(hotel.revenue || 0).toLocaleString()}
Bookings: ${(hotel.bookings || 0).toLocaleString()}
${hotel.lastUpdated ? `Last Updated: ${new Date(hotel.lastUpdated).toLocaleString()}` : ''}
                `;
                alert(details);
            }
        }
        
        // Edit hotel (placeholder)
        function editHotel(hotelName) {
            showNotification('Edit functionality - opening update form', 'info');
            updateHotel(hotelName);
        }
        
        // Update hotel
        function updateHotel(hotelName) {
            const hotel = hotels.find(h => h.name === hotelName);
            if (!hotel) return;
            
            currentHotel = hotel;
            
            // Populate form
            document.getElementById('updateName').value = hotel.name;
            document.getElementById('updateAddress').value = hotel.address || '';
            document.getElementById('updateArea').value = hotel.area || '';
            document.getElementById('updateType').value = hotel.type || '5-star luxury';
            document.getElementById('updatePriority').value = hotel.priority || 'P1';
            document.getElementById('updatePhone').value = hotel.phone || '';
            document.getElementById('updateEmail').value = hotel.email || '';
            document.getElementById('updateWhatsapp').value = hotel.whatsapp || '';
            document.getElementById('updateRevenue').value = hotel.revenue || '';
            document.getElementById('updateBookings').value = hotel.bookings || '';
            
            // Show sync indicator if applicable
            if (hotel.syncedFromVisits) {
                document.getElementById('syncIndicator').style.display = 'block';
            } else {
                document.getElementById('syncIndicator').style.display = 'none';
            }
            
            // Show modal
            document.getElementById('updateModal').style.display = 'block';
        }
        
        // Save hotel update
        function saveHotelUpdate(event) {
            event.preventDefault();
            
            if (!currentHotel) return;
            
            // Update hotel data
            currentHotel.name = document.getElementById('updateName').value;
            currentHotel.address = document.getElementById('updateAddress').value;
            currentHotel.area = document.getElementById('updateArea').value;
            currentHotel.type = document.getElementById('updateType').value;
            currentHotel.priority = document.getElementById('updatePriority').value;
            currentHotel.phone = document.getElementById('updatePhone').value;
            currentHotel.email = document.getElementById('updateEmail').value;
            currentHotel.whatsapp = document.getElementById('updateWhatsapp').value;
            currentHotel.revenue = parseFloat(document.getElementById('updateRevenue').value) || 0;
            currentHotel.bookings = parseInt(document.getElementById('updateBookings').value) || 0;
            currentHotel.lastUpdated = new Date().toISOString();
            
            // Save to localStorage
            saveHotelUpdates();
            
            // Update display
            updateStats();
            displayHotels();
            
            // Close modal
            closeUpdateModal();
            
            showNotification('Hotel information updated successfully!', 'success');
        }
        
        // Close update modal
        function closeUpdateModal() {
            document.getElementById('updateModal').style.display = 'none';
            currentHotel = null;
        }
        
        // Sync specific hotel from visits
        function syncHotelFromVisits(hotelName) {
            const hotel = hotels.find(h => h.name === hotelName);
            if (!hotel) return;
            
            const visits = JSON.parse(localStorage.getItem('oscar_visits') || '[]');
            const completedVisits = JSON.parse(localStorage.getItem('visitHistory') || '[]');
            const allVisits = [...visits, ...completedVisits];
            
            const hotelVisits = allVisits.filter(visit => 
                visit.hotel?.toLowerCase().includes(hotel.name.toLowerCase()) ||
                hotel.name.toLowerCase().includes(visit.hotel?.toLowerCase() || '')
            );
            
            let updated = false;
            
            hotelVisits.forEach(visit => {
                if (visit.contactEmail && (!hotel.email || hotel.email !== visit.contactEmail)) {
                    hotel.email = visit.contactEmail;
                    updated = true;
                }
                
                if (visit.contactPhone && (!hotel.phone || hotel.phone !== visit.contactPhone)) {
                    hotel.phone = visit.contactPhone;
                    updated = true;
                }
                
                if (visit.whatsappNumber && (!hotel.whatsapp || hotel.whatsapp !== visit.whatsappNumber)) {
                    hotel.whatsapp = visit.whatsappNumber;
                    updated = true;
                }
            });
            
            if (updated) {
                hotel.lastUpdated = new Date().toISOString();
                hotel.syncedFromVisits = true;
                saveHotelUpdates();
                updateStats();
                displayHotels();
                showNotification(`${hotel.name} synced successfully!`, 'success');
            } else {
                showNotification('No new data found to sync', 'info');
            }
        }
        
        function viewCommunication(hotelName) {
            alert(`Displaying communication history for ${hotelName}. (Feature under development - will show detailed communication log here.)`);
        }

        // Show notification
        function showNotification(message, type) {'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                padding: 12px 20px; border-radius: 8px; color: white;
                font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // Open add hotel modal
        function openAddHotelModal() {
            document.getElementById('addHotelModal').style.display = 'block';
        }
        
        // Close add hotel modal
        function closeAddHotelModal() {
            document.getElementById('addHotelModal').style.display = 'none';
            // Reset form
            document.querySelector('#addHotelModal form').reset();
        }
        
        // Save new hotel
        function saveNewHotel(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const newHotel = {
                id: Date.now(), // Simple ID generation
                name: formData.get('name'),
                location: formData.get('location'),
                type: formData.get('type'),
                priority: formData.get('priority'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                whatsapp: formData.get('whatsapp'),
                notes: formData.get('notes'),
                revenue: 0,
                bookings: 0,
                lastUpdated: new Date().toISOString(),
                syncedFromVisits: false
            };
            
            // Add to hotels array
            hotels.push(newHotel);
            
            // Save to localStorage
            localStorage.setItem('hotels', JSON.stringify(hotels));
            
            // Update display
            displayHotels();
            
            // Close modal
            closeAddHotelModal();
            
            // Show success message
            showNotification('Hotel added successfully!', 'success');
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const updateModal = document.getElementById('updateModal');
            const addModal = document.getElementById('addHotelModal');
            
            if (event.target === updateModal) {
                closeUpdateModal();
            } else if (event.target === addModal) {
                closeAddHotelModal();
            }
        }
    </script>
</body>
</html>
